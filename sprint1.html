<!DOCTYPE html>
<html>

<head>
    <title>Sprint 1</title>
    <!-- CSS for styling table and gallery items -->
    <style>
       table {
            background-color: lightgray;
            border-collapse: collapse;
            width: 100%;
            border: 2px solid black;
            /* Add this line to set the border around the table */
        }

        td {
            border: 1px solid black;
            padding: 8px;
            text-align: center;
        }

        .gallery-item {
            border: 1px solid black;
            padding: 10px;
            display: inline-block;
            margin: 5px;
        }
    </style>
</head>

<body>

    <!-- Dropdown for selecting the display type -->
    <label for="fileType">Choose File Type:</label>
    <select name="fileType" id="fileTypes">
        <option value="Raw"> Raw</option>
        <option value="Table"> Table</option>
        <option value="Gallery"> Gallery</option>


   

    </select>

    <!-- File input to upload CSV or Excel files -->
    <input type="file" id="inputFile" accept=".csv, .xlsx, .xls">
    <pre id="csvData"></pre>
    <!-- Textarea for displaying raw JSON data -->
    <textarea name="" id="taResults" cols="100" rows="10"></textarea>
    <!-- Button to trigger data view -->
    <button id="btnView">click here to view the data</button>
    <!-- Div to display the output -->
    <div id="output"></div>
    <label for="txtPk">Available key to identify an entry</label>
    <textarea name="txtPk" id="txtPk" cols="30" rows="2" disabled="true"></textarea>
    <button id="btnPK">Click here to find primary key</button>

    <!-- Dropdown for input and output -->
    <Form>
    <select id = "selectedInput">
        <option>Choose Input Columns </option>
    </select>
    </Form>

    <Form>
    <select id = "selectedOutput">
        <option>Choose Output Columns </option>
    </select>
    
    </Form>    
    <button id="btnClear" onclick="clearEverything()">Click Here to Clear out the information</button>
    <br>
    
    <!-- Including xlsx library for handling Excel files -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.0/xlsx.full.min.js"></script>

    <script>
        document.getElementById("selectedOutput").disabled = true;
        document.getElementById("selectedInput").disabled = true;
        // Variable to hold the parsed data from the uploaded file
        let myArray;
        // Output div where the data will be displayed
        const outputDiv = document.getElementById('output');
        //2D array to store the selected input and output columns
        const selectedColumns = {input:[], output: [] };

        // Event listener for the "View Data" button
        document.getElementById("btnView").addEventListener('click', function() {
            //enable 
            
            // Get the selected display type from the dropdown
            const selectElement = document.querySelector('#fileTypes');
            const specifiedView = selectElement.value;

            

            // Display data according to the selected type
            switch (specifiedView) {
                case 'Raw':
                    // Display as Raw JSON data
                    outputDiv.innerHTML = JSON.stringify(myArray, null, 2);
                    break;
                case 'Table':
                    // Display as HTML Table
                    const table = document.createElement('table');
                    for (let row of myArray) {
                        let newRow = table.insertRow();
                        for (let cell of row) {
                            let newCell = newRow.insertCell();
                            newCell.textContent = cell;
                        }
                    }
                    outputDiv.innerHTML = '';
                    outputDiv.appendChild(table);
                    break;
                case 'Gallery':
                    // Display as a gallery of divs
                    let galleryHTML = '';
                    for (let row of myArray) {
                        let item = '<div class="gallery-item">' + row.join(' | ') + '</div>';
                        galleryHTML += item;
                    }
                    outputDiv.innerHTML = galleryHTML;
                    break;
            }
        });

        // Event listener for file input change
        document.getElementById('inputFile').addEventListener('change', function (event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const fileData = e.target.result;
                    // Handle CSV files
                    if (file.name.endsWith('.csv')) {
                        myArray = csvToArray(fileData);
                        populateDropdown("selectedInput", myArray[0]);
                        populateDropdown("selectedOutput", myArray[0]);
                    } 
                    // Handle Excel files
                    else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                        const workbook = XLSX.read(fileData, { type: 'binary' });
                        const firstSheet = workbook.SheetNames[0];
                        myArray = XLSX.utils.sheet_to_json(workbook.Sheets[firstSheet], { header: 1 });
                        populateDropdown("selectedInput", myArray[0]);
                        populateDropdown("selectedOutput", myArray[0]);
                    }
                    // Update the textarea with the parsed data
                    document.getElementById('taResults').value = JSON.stringify(myArray, null, 2);
                };
                // Read the file accordingly
                if (file.name.endsWith('.csv')) {
                    reader.readAsText(file);
                } else if (file.name.endsWith('.xlsx') || file.name.endsWith('.xls')) {
                    reader.readAsBinaryString(file);
                }
            }
        });//end event Listener for inputFile
        //Event listener for input dropdown change
        document.getElementById('selectedInput').addEventListener('change', function() {
            const selectedInputIndex = this.value;
            if (selectedInputIndex !== '') {
                 if (selectedColumns.output.includes(selectedInputIndex)) {
                        // column is already an output; reset the input dropdown
                    this.value = '';
                    alert("This column is already selected as an output.");
             }  
                 else {
                    selectedColumns.input.push(selectedInputIndex);
                    document.getElementById('selectedInput').option[selectedInputIndex].disable = true;
                    // Disable the selected input in the output dropdown
                    for (let i = 0; i < document.getElementById('selectedOutput').options.length; i++) {
                        if (i == selectedInputIndex) {
                            document.getElementById('selectedOutput').options[i].disabled = true;
                        } else {
                            document.getElementById('selectedOutput').options[i].disabled = false;
                        }
                }
            }
            }
            
        });//end event Listner for selectedInput
        document.getElementById('selectedOutput').addEventListener('change', function() {
            const selectedOutputIndex = this.value;
            if (selectedOutputIndex !== '') {
                 if (selectedColumns.input.includes(selectedOutputIndex)) {
                    // The selected column is already an input; reset the output dropdown
                    this.value = '';
                    alert("This column is already selected as an input.");
                }
                 else {
                    selectedColumns.output.push(selectedOutputIndex);
                    document.getElementById('selectedOutput').options[selectedOutputIndex].disabled = true;
                    // Disable the selected output in the input dropdown
                    for (let i = 0; i < document.getElementById('selectedInput').options.length; i++) {
                        if (i == selectedOutputIndex) {
                            document.getElementById('selectedInput').options[i].disabled = true;
                        } else {
                            document.getElementById('selectedInput').options[i].disabled = false;
                        }
                    }
            }
        }        });
        // Function to convert CSV data to an array
        function csvToArray(csvData) {
            const rows = csvData.split('\n');
            const result = [];
            rows.forEach(row => {
                const columns = row.split(',');
                result.push(columns);
            });
            myArray = result;
            return result;
        }
        function populateDropdown(dropdownId, data) {
            const dropdown = document.getElementById(dropdownId);
            const inputDropdown = document.getElementById("selectedInput");
            dropdown.innerHTML = "";
            data.forEach((item, index) => {
                const option = document.createElement("option");
                option.value = index;
                option.text = item;
                if (dropdownId === "selectedOutput" && inputDropdown.value === index) {
                    option.disabled = true;
                }
        
                dropdown.add(option);
            });
            dropdown.disabled = false;
        }//end populateDropDown

        //Event listener for the primary key button. calls the function and displays the answer in the text box
        document.getElementById("btnPK").addEventListener('click', function () {
            const primaryKeyResult = findPrimaryKey(myArray);
            document.getElementById('txtPk').value = primaryKeyResult;
        });
        // The actual code to find the primary key.
        function findPrimaryKey(data) {
            if (data.length === 0) {
                return "No data available";
            }
            const firstColumn = data.map(row => row[0]);
            const uniqueValues = new Set(firstColumn);
            // checks if the column has unique data
            if (uniqueValues.size === data.length) {
                return `Primary key found: ${data[0][0]}`;
            } else {
                //if there are duplicates found in the column - we have none
                return "No primary key found";
            }
        }

         function clearEverything(){
            document.getElementById("taResults").value = "";
            outputDiv.innerHTML = "";
            document.getElementById('txtPk').value =" ";

        }
    </script>
</body>
</html>
